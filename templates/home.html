{% extends "_layout.html" %}

{% block content%}
<div class="container content">
  <div class="mt-3">
    <h1 style="text-align: center;">Twitter Crawler</h1>

    <div class="d-flex justify-content-center mt-3">
      <form class="form-inline" method="get">
        <div>
          <label class="sr-only" for="inlineFormInputName2">Name</label>
          <input name="city" type="text" class="form-control" id="inlineFormInputName2" placeholder="City">
        </div>

        <label class="sr-only" for="inlineFormInputGroupUsername2">Username</label>

        <select name="followers" class="custom-select ml-2" id="inlineFormCustomSelectPref">
          <option selected value="">Followers...</option>
          <option value="1">
            < 50 </option> <option value="2"> 50 - 80
          </option>
          <option value="3"> 81 - 100</option>
          <option value="4"> 100 < </option> </select> <button type="submit" class="btn btn-primary ml-2">
              Search</button>
              <a href="{url_for('index')}"><button class="btn btn-warning ml-2">Reset Filters</button></a>
      </form>
    </div>
    <div class="text-center">
      {% if request.args.get('city') %}
      <p><small>Results for {{ request.args.get('city') }} {{ request.args.get('followers') }}</small></p>
      {% else %}
      <p><small class="d-none">Pick a city</small></p>
      {% endif %}
    </div>

    <hr />
  </div>



  <table class="table">
    <thead>
      <tr>
        <!-- <th scope="col">#</th> -->
        <th class="text-center" scope="col"></th>
        <th class="text-center" scope="col">Username</th>
        <th class="text-center" scope="col">Profile Photo</th>
        <th class="text-center" scope="col">Followers</th>
        <th class="text-center" scope="col">Following</th>
        <th class="text-center" scope="col">Location</th>
        <!-- <th class="text-center" scope="col">Popular Hashtags</th> -->
        <th class="text-center" scope="col">Hashtags</th>

        <!-- <th class="text-center" scope="col">Hashtag</th> -->
        <!-- <th scope="col">Handle</th> -->
      </tr>
    </thead>

    <tbody>
      {% for user in users.items %}
      <tr class="text-center">
        <td>
          <div class="checkbox">
            <label><input type="checkbox" value=""></label>
          </div>
        </td>

        <td> <a href="https://twitter.com/{{ user.screen_name }}" target="_blank">{{ user.screen_name }} </a></td>
        <!-- Profile Photo Check/Display-->
        {% if user.profile_image_url %}
        <td class="text-center"> <a href="https://twitter.com/{{ user.screen_name }}" target="_blank"><img
              class="rounded-circle" src="{{ user.profile_image_url }}"></a></td>
        {% else %}
        <td class="text-center">
          <p>n/a</p>
        </td>
        {% endif%}

        <td>{{ user.followers_count}}</td>
        <td>{{ user.friends_count}}</td>
        <td> {{ user.location }}</td>
        <!-- <td>
          <ul>
            {% for tweet in user.tweets %}
            {% if loop.index <= 5 %}
            {% for hashtag in tweet.hashtags %}
            <li href=>#{{hashtag.hashtag}}</li>
            {% endfor %}
            {% endif %}
            {% endfor %}
          </ul>
        </td> -->
        <td>
          <ul>
            {% set tags = [] %}
            {% for tweet in user.tweets %}
            {% for hashtag in tweet.hashtags %}
            {% if tags.append(hashtag.hashtag) %}{% endif %}
            {% endfor %}
            {% endfor %}
            
            {% set frequency = [] %}
            {% for tag in tags %}
            {% if frequency.append(tags.count(tag)) %}{% endif %}
            {% endfor %}

            <!-- {{frequency}}
            {{ frequency | max }} -->

            
            
            {% if tags %}
            <div class="container">
              <div class="row">
                <div class="col-3">
                  <h6>Hashtags</h6>
                </div>
                <div class="col-9">
                  <h6>Frequency</h6>
                </div>
              </div>
              {% for tag in tags %}
              {% if loop.index <=5 %}
              <div class="row">
                <div class="col-5">
                  <label for="keyword">#{{tag}}</label>
                </div>
                <div class="col-7">
                  <div class="progress" style="height: 2rem;">
                    <div class="progress-bar bg-primary" role="progressbar"
                      style="width: {{ tags.count(tag)/13 * 100 }}%" aria-valuemin="0" aria-valuemax="100">
                      {{tags.count(tag)}}</div>
                  </div>
                </div>
              </div>
              {% endif %}
              {% endfor %}
            </div>

            {% endif %}

          </ul>
        </td>
        <!-- <td> {{ user.hashtag_name }}</td> -->

      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class=text-center>
    <p><small>Total results {{ users.total }} </small></p>
    {% for page_num in users.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
    {% if page_num %}
    {% if users.page == page_num %}
    <a class="btn btn-info mb-4" href="{{ url_for('index', page=page_num) }}"><small>{{ page_num }} </a>
    {% else %}
    <a class="btn btn-outline-info mb-4" href="{{ url_for('index', page=page_num) }}">{{ page_num }}</a>
    {% endif %}
    {% else %}
    ...
    {% endif %}
    {% endfor %}
  </div>

  <div>
    <button class="save_to_csv_btn">Save to CSV</button>
  </div>

</div>

{% endblock %}